{% extends "base.html" %}

{% block title %}×¨×©×™××ª ×©×™×¨×™×{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/songs.css') }}">
{% endblock %}

{% block content %}
<div class="songs-container">
    <!-- Page Header -->
    <div class="page-header">
        <h1 class="page-title">ğŸµ ×¨×©×™××ª ×©×™×¨×™×</h1>
        <p class="page-subtitle">×’×œ×” ××ª ×”×©×™×¨×™× ×”××™×•×—×“×™× ×©×œ× ×• ×•×ª×ª×—×™×œ ×œ× ×’×Ÿ</p>

        <div class="songs-count">
            <span class="count-number">{{ songs|length }}</span>
            <span class="count-label">×©×™×¨×™× ×–××™× ×™×</span>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
            {% set roles = session.get('roles', []) %}
            {% if 'teacher' in roles or 'admin' in roles %}
                <a href="{{ url_for('songs.add_song_page') }}" class="add-song-btn">
                    <span>â•</span>
                    <span>×”×•×¡×£ ×©×™×¨ ×—×“×©</span>
                </a>
            {% endif %}
            {% if session.get('user_id') %}
                <a href="{{ url_for('my_songs.my_songs_page') }}" class="my-songs-link-btn">
                    <span>â¤ï¸</span>
                    <span>×”×©×™×¨×™× ×©×œ×™</span>
                </a>
            {% endif %}
        </div>

    </div>

    <!-- Filter Section -->
    <div class="filter-section">
        <div class="filter-controls">
            <div class="search-box">
                <span class="search-icon">ğŸ”</span>
                <input type="text" id="search-input" placeholder="×—×¤×© ×©×™×¨ ××• ×××Ÿ...">
            </div>

            <select id="sort-select" class="sort-dropdown">
                <option value="title">××™×•×Ÿ ×œ×¤×™ ×©× ×”×©×™×¨</option>
                <option value="artist">××™×•×Ÿ ×œ×¤×™ ×××Ÿ</option>
                <option value="difficulty">××™×•×Ÿ ×œ×¤×™ ×¨××ª ×§×•×©×™</option>
                <option value="bpm">××™×•×Ÿ ×œ×¤×™ BPM</option>
            </select>
        </div>
    </div>

    <!-- Songs Grid -->
    {% if songs %}
        <div class="songs-grid">
            {% for song in songs %}
                <div class="song-card" id="song-{{ song.id }}"
                     data-difficulty="{{ song.difficulty }}"
                     data-bpm="{{ song.bpm }}"
                     data-key="{{ song.key }}"
                     data-time-signature="{{ song.time_signature }}">

                    <div class="song-header">
                        <div class="song-info">
                            <h3>{{ song.title }}</h3>
                            <p>{{ song.artist }}</p>
                        </div>
                    </div>

                    <div class="song-details">
                        <span class="detail-badge">
                            ğŸ¼ {{ song.key }} {{ song.key_type }}
                        </span>
                        <span class="detail-badge">
                            ğŸµ {{ song.time_signature }}
                        </span>
                        <span class="detail-badge">
                            âš¡ {{ song.bpm }} BPM
                        </span>
                        {% if song.difficulty %}
                        <span class="detail-badge difficulty-{{ song.difficulty }}">
                            â­ {{ song.difficulty }}
                        </span>
                        {% endif %}
                    </div>

                    <div class="song-actions">
                        <a href="{{ url_for('songs.play_song', song_id=song.id) }}" class="action-btn play-btn">
                            <span>ğŸµ</span>
                            <span>×œ×¢××•×“ ×”×©×™×¨</span>
                        </a>

                        {% if session.get('user_id') %}
                            <button class="action-btn my-songs-btn"
                                    data-song-id="{{ song.id }}"
                                    onclick="toggleMySong('{{ song.id }}', this)">
                                <span class="icon">â¤ï¸</span>
                                <span class="text">×”×•×¡×£ ×œ×©×™×¨×™× ×©×œ×™</span>
                            </button>
                        {% endif %}

                        {% if session.get('user_id') == song.created_by %}
                            <a href="{{ url_for('songs.edit_song', song_id=song.id) }}" class="action-btn edit-btn">
                                <span>âœï¸</span>
                                <span>×¢×¨×•×š</span>
                            </a>

                            <button class="action-btn delete-btn"
                                    onclick="deleteSong('{{ song.id }}', '{{ song.title }}')">
                                <span>ğŸ—‘ï¸</span>
                            </button>
                        {% endif %}
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="empty-state">
            <div class="empty-icon">ğŸµ</div>
            <h3>××™×Ÿ ×©×™×¨×™× ×–××™× ×™×</h3>
            <p>×¢×“×™×™×Ÿ ×œ× × ×•×¡×¤×• ×©×™×¨×™× ×œ××¢×¨×›×ª</p>
            {% set roles = session.get('roles', []) %}
            {% if 'teacher' in roles or 'admin' in roles %}
                <a href="{{ url_for('songs.add_song_page') }}" class="browse-btn">
                    <span>â•</span>
                    <span>×”×•×¡×£ ×©×™×¨ ×¨××©×•×Ÿ</span>
                </a>
            {% endif %}
        </div>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/songs.js') }}"></script>
{% endblock %}
