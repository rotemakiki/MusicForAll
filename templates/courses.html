{% extends "base.html" %}

{% block title %}×§×•×¨×¡×™×{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/courses.css') }}">
{% endblock %}

{% block content %}
<div class="courses-container">
    <div class="courses-card">
        <div class="page-header">
            <h1 class="page-title">ğŸ“ ×§×•×¨×¡×™×</h1>
            <p class="page-subtitle">×œ××“ ××•×–×™×§×” ×¢× ×”××•×¨×™× ×”×˜×•×‘×™× ×‘×™×•×ª×¨</p>
            {% set roles = session.get('roles', []) %}
            {% if 'teacher' in roles or 'musician' in roles or 'admin' in roles %}
                <a href="{{ url_for('courses.manage_courses') }}" class="manage-courses-btn">
                    <i class="fas fa-cog"></i>
                    <span>× ×™×”×•×œ ×§×•×¨×¡×™×</span>
                </a>
            {% endif %}
        </div>

        <div id="loadingState" class="loading-state">
            <i class="fas fa-spinner fa-spin"></i>
            <p>×˜×•×¢×Ÿ ×§×•×¨×¡×™×...</p>
        </div>

        <div id="errorState" class="error-state" style="display: none;">
            <i class="fas fa-exclamation-triangle"></i>
            <p>×©×’×™××” ×‘×˜×¢×™× ×ª ×”×§×•×¨×¡×™×</p>
        </div>

        <div id="coursesGrid" class="courses-grid" style="display: none;">
            <!-- ×”×§×•×¨×¡×™× ×™×•×›× ×¡×• ×›××Ÿ ×‘××•×¤×Ÿ ×“×™× ××™ -->
        </div>

        <div id="emptyState" class="empty-state" style="display: none;">
            <div class="empty-icon">
                <i class="fas fa-graduation-cap"></i>
            </div>
            <h3>××™×Ÿ ×§×•×¨×¡×™× ×–××™× ×™×</h3>
            <p>×œ× × ××¦××• ×§×•×¨×¡×™× ×œ×”×¦×’×” ×›×¨×’×¢. ×‘×“×•×§ ×©×•×‘ ×××•×—×¨ ×™×•×ª×¨.</p>
        </div>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const loadingState = document.getElementById("loadingState");
    const errorState = document.getElementById("errorState");
    const coursesGrid = document.getElementById("coursesGrid");
    const emptyState = document.getElementById("emptyState");

    fetch("/api/courses")
        .then(response => response.json())
        .then(data => {
            loadingState.style.display = "none";
            
            if (data.success && data.courses && data.courses.length > 0) {
                coursesGrid.style.display = "grid";
                displayCourses(data.courses);
            } else {
                emptyState.style.display = "block";
            }
        })
        .catch(error => {
            console.error("×©×’×™××” ×‘×˜×¢×™× ×ª ×”×§×•×¨×¡×™×:", error);
            loadingState.style.display = "none";
            errorState.style.display = "block";
        });

    function displayCourses(courses) {
        coursesGrid.innerHTML = "";
        
        courses.forEach(course => {
            const courseCard = document.createElement("div");
            courseCard.className = "course-card";
            courseCard.onclick = () => window.location.href = `/course/${course.id}`;
            
            const priceDisplay = course.price === 0 ? 
                '<span class="price-badge free">×—×™× ×</span>' : 
                `<span class="price-badge paid">â‚ª${course.price}</span>`;
            
            const ratingDisplay = course.avg_rating > 0 ? 
                `<div class="course-rating">
                    <i class="fas fa-star"></i>
                    <span>${course.avg_rating}</span>
                    <span class="reviews-count">(${course.reviews_count})</span>
                </div>` : 
                '<div class="course-rating no-rating">×¢×“×™×™×Ÿ ××™×Ÿ ×“×™×¨×•×’×™×</div>';
            
            courseCard.innerHTML = `
                <div class="course-image">
                    <i class="fas fa-music"></i>
                </div>
                <div class="course-content">
                    <div class="course-header">
                        <h3 class="course-title">${course.title || '×œ×œ× ×›×•×ª×¨×ª'}</h3>
                        ${priceDisplay}
                    </div>
                    <p class="course-field">${course.musical_field || '××•×–×™×§×”'}</p>
                    <p class="course-description">${(course.description || '').substring(0, 100)}${course.description && course.description.length > 100 ? '...' : ''}</p>
                    <div class="course-meta">
                        ${ratingDisplay}
                        <div class="course-stats">
                            <span><i class="fas fa-play-circle"></i> ${course.lessons_count || 0} ×©×™×¢×•×¨×™×</span>
                        </div>
                    </div>
                </div>
                <div class="course-actions">
                    <button class="view-course-btn">
                        <i class="fas fa-arrow-left"></i>
                        <span>×¦×¤×” ×‘×§×•×¨×¡</span>
                    </button>
                </div>
            `;
            
            coursesGrid.appendChild(courseCard);
        });
    }
});
</script>
{% endblock %}

